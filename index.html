<!doctype html>
<html lang="ar" dir="rtl">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>ÙŠÙˆØ³Ù â€” Ù†Ø´Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª</title>
Â  <style>
Â  Â  :root{--accent:#0ea5a3;--bg:#0f172a;--card:#0b1220;--glass:rgba(255,255,255,0.04)}
Â  Â  *{box-sizing:border-box;font-family: Cairo, 'Segoe UI', Tahoma, sans-serif}
Â  Â  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%, #0b1220 100%);color:#e6eef6}
Â  Â  header{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.03)}
Â  Â  .brand{display:flex;gap:12px;align-items:center}
Â  Â  .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#2563eb);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;color:white}
Â  Â  h1{margin:0;font-size:18px}
Â  Â  p.lead{margin:0;color:#9fb3c7;font-size:13px}
Â  Â  main{padding:20px;max-width:1100px;margin:18px auto}
Â  Â  /* ğŸ’¡ğŸ’¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¹ÙƒØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ğŸ’¡ğŸ’¡ */
Â  Â  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
Â  Â  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(3,7,18,0.6)}
Â  Â  label{font-size:13px;color:#bcd5df}
Â  Â  input[type=text],textarea,select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
Â  Â  textarea{min-height:120px;resize:vertical}
Â  Â  button{background:var(--accent);border:none;color:#052022;padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
Â  Â  .muted{color:#92a9b9;font-size:13px}
Â  Â  .posts{display:flex;flex-direction:column;gap:12px}
Â  Â  .post{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
Â  Â  .post .meta{display:flex;justify-content:space-between;gap:8px;align-items:center}
Â  Â  .post .content{white-space:pre-wrap;margin-top:10px;font-family:inherit}
Â  Â  .actions{display:flex;gap:8px;margin-top:10px}
Â  Â  .chip{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-size:13px}
Â  Â  .search{display:flex;gap:8px;margin-bottom:12px}
Â  Â  .empty{color:#7f98a9;text-align:center;padding:40px 10px}
Â  Â  footer{max-width:1100px;margin:10px auto;text-align:center;color:#7da9bb;font-size:13px}
Â  Â  @media(max-width:880px){.grid{grid-template-columns:1fr}header{flex-wrap:wrap;gap:8px}.brand p{display:none}}
Â  </style>
</head>
<body>
Â  <header>
Â  Â  <div class="brand">
Â  Â  Â  <div class="logo">ÙŠÙˆØ³Ù</div>
Â  Â  Â  <div>
Â  Â  Â  Â  <h1>ÙŠÙˆØ³Ù ÙˆØ§ Ù…ÙƒØ§Ø±ÙŠÙˆØ³</h1>
Â  Â  Â  Â  <p class="lead">Ù…Ù†ØµØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù†Ø´Ø± ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª â€” Ø£Ù†Ø´Ø±ØŒ Ø§Ù†Ø³Ø®ØŒ ÙˆØ¬Ø±Ù‘Ø¨</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="muted">ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ ÙŠÙˆØ³Ù Ø§Ø­Ù…Ø¯ Ø®Ù„ÙŠÙÙ‡.</div>
Â  </header>

Â  <main>
Â  Â  <div class="grid">
      Â  Â  Â  <section>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
Â  Â  Â  Â  Â  Â  <div style="flex:1;display:flex;gap:8px;align-items:center">
Â  Â  Â  Â  Â  Â  Â  <input id="searchInput" type="text" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£Ùˆ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ÙˆØ³ÙˆÙ…" />
Â  Â  Â  Â  Â  Â  Â  <select id="filterTag"><option value="">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ³Ù…</option></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:8px;align-items:center">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div id="postsContainer" class="posts"></div>
Â  Â  Â  Â  Â  <div id="emptyState" class="empty" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø¨Ø¹Ø¯ â€” ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø±!</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="height:12px"></div>
Â  Â  Â  Â  <div class="card" style="padding:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
Â  Â  Â  Â  Â  <div class="chip">Ù…Ø­ÙÙˆØ¸ ÙÙŠ: Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</div>
Â  Â  Â  Â  Â  <div class="chip">Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª: <span id="count">0</span></div>
Â  Â  Â  Â  Â  <div class="chip">Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªØµÙ„</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </section>
      
      Â  Â  Â  <aside class="card">
Â  Â  Â  Â  <h3>Ø§Ù†Ø´Ø± Ø¨Ø±ÙˆÙ…Øª Ø¬Ø¯ÙŠØ¯</h3>
Â  Â  Â  Â  <div style="height:8px"></div>
Â  Â  Â  Â  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø¯Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
Â  Â  Â  Â  <input id="author" type="text" placeholder="Ù…Ø«Ø§Ù„: ÙŠÙˆØ³Ù" />

Â  Â  Â  Â  <label>Ø¹Ù†ÙˆØ§Ù† Ù…Ø®ØªØµØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
Â  Â  Â  Â  <input id="title" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø¨Ø±ÙˆÙ…Øª" />

Â  Â  Â  Â  <label>Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª</label>
Â  Â  Â  Â  <textarea id="prompt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ù‡Ù†Ø§... Ù…Ø«Ø§Ù„: 'Ø£Ø¹Ø·Ù†ÙŠ Ù‚ØµØ© Ù‚ØµÙŠØ±Ø© Ø¹Ù†...'" ></textarea>

Â  Â  Â  Â  <label>ÙˆØ³Ù…/ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
Â  Â  Â  Â  <input id="tag" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ø§Ø¯Ø«Ø©ØŒ ØµÙˆØ±Ø©ØŒ ØªØ±Ø¬Ù…Ø©" />

Â  Â  Â  Â  <div style="height:12px"></div>
Â  Â  Â  Â  <div style="display:flex;gap:8px">
Â  Â  Â  Â  Â  <button id="publishBtn">Ù†Ø´Ø±</button>
Â  Â  Â  Â  Â  <button id="clearBtn" style="background:#334155;color:#e6eef6">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="height:12px"></div>
Â  Â  Â  Â  <div class="muted">Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… ÙˆØµÙÙ‹Ø§ Ø¯Ù‚ÙŠÙ‚Ù‹Ø§ ÙˆØ§Ø®ØªØ¨Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙŠ Ø³ØªØ³ØªØ®Ø¯Ù…Ù‡ (Ù…Ø«Ù„ ChatGPT Ø£Ùˆ gemini).</div>
Â  Â  Â  </aside>
Â  Â  </div>
Â  </main>

Â  <footer>
Â  Â Ù…ÙˆÙ‚Ø¹ ÙŠÙˆØ³Ù Ø§Ø­Ù…Ø¯ Ø®Ù„ÙŠÙÙ‡
Â  </footer>

Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

Â  <script>
Â  // /////////////////////////////////////////////////////////////
// // Ù…Ø­ØªÙˆÙ‰ ÙˆØ³Ù… <script> Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬ //
// /////////////////////////////////////////////////////////////

// 1. Ù…ÙØ§ØªÙŠØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const firebaseConfig = {
Â  Â  // Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªÙŠ Ù†Ø³Ø®ØªÙ‡Ø§ Ù…Ù† ØµÙˆØ±ØªÙƒ
Â  Â  apiKey: "AIzaSyP016himjW1TiccHc0SiByPjOW0Vzv_Vs",
Â  Â  authDomain: "yousefprompts-public-58082.firebaseapp.com",
Â  Â  projectId: "yousefprompts-public-58082",
Â  Â  storageBucket: "yousefprompts-public-58082.appspot.com",
Â  Â  messagingSenderId: "1029355842188",
Â  Â  appId: "1:1029355842188:web:b72df7144a0027c2e6da39",
Â  Â  measurementId: "G-JY7D5F10YT"
};

// 2. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const PROMPTS_COLLECTION = 'prompts'; // Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©

const el = id => document.getElementById(id);

function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }


// 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ø±Ø¶ (render) Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore
const render = async () => {Â 
Â  const container = el('postsContainer');
Â  container.innerHTML = '';
Â Â 
Â  let query = db.collection(PROMPTS_COLLECTION).orderBy('createdAt', 'desc');

Â  const filter = el('filterTag').value.trim();
Â  const q = el('searchInput').value.trim().toLowerCase();

Â  let visible = [];
Â  try {
Â  Â  const snapshot = await query.get();
Â  Â  snapshot.forEach(doc => {
Â  Â  Â  Â  const p = { id: doc.id, ...doc.data() };Â 

Â  Â  Â  Â  if(filter && p.tag !== filter) return;
Â  Â  Â  Â  if(q && !((p.title||'').toLowerCase().includes(q) || p.prompt.toLowerCase().includes(q) || (p.author||'').toLowerCase().includes(q) || (p.tag||'').toLowerCase().includes(q))) return;

Â  Â  Â  Â  visible.push(p);
Â  Â  });
Â  } catch (e) {
Â  Â  Â  console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
Â  Â  Â  return;
Â  }
Â Â 

Â  if(visible.length===0){ el('emptyState').style.display='block'; } else { el('emptyState').style.display='none'; }
Â  el('count').innerText = visible.length;
Â Â 
Â  visible.forEach(p=>{
Â  Â  const div = document.createElement('div'); div.className='post';
Â  Â Â 
Â  Â  const displayDate = p.createdAt && p.createdAt.toDate ? p.createdAt.toDate().toLocaleString('ar-EG') : 'Ø§Ù„Ø¢Ù†';

Â  Â  div.innerHTML = `
Â  Â  Â  <div class="meta">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <strong>${escapeHtml(p.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</strong>
Â  Â  Â  Â  Â  <div class="muted">${escapeHtml(p.author || 'Ù…Ø¬Ù‡ÙˆÙ„')} Â· ${displayDate}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="text-align:left;min-width:140px">
Â  Â  Â  Â  Â  <span class="chip">${escapeHtml(p.tag||'Ø¹Ø§Ù…')}</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="content">${escapeHtml(p.prompt)}</div>
Â  Â  Â  <div class="actions">
Â  Â  Â  Â  <button onclick='copyPrompt("${p.id}")'>Ù†Ø³Ø®</button>
Â  Â  Â  Â  <button onclick='toggleLike("${p.id}")'>${p.likes||0} â¤ï¸</button>
Â  Â  Â  </div>

      <div class="comments-section" style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 10px;">
        <div class="comment-form" style="display:flex; gap:8px; margin-bottom: 15px; align-items: stretch;">
          <input type="text" id="commentText-${p.id}" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ..." style="flex:1; margin-top:0;" />
          <button onclick='postComment("${p.id}")' style="min-width: 80px; padding: 0 10px;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <div id="commentsContainer-${p.id}" class="comments-list">
          </div>
      </div>
Â  Â  `;
Â  Â  container.appendChild(div);
    renderComments(p.id); 
Â  });

Â  refreshFilterOptions(visible.map(p=>p.tag).filter(Boolean));
}


// 4. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø´Ø± (Publish)
document.getElementById('publishBtn').addEventListener('click', async ()=>{
Â  const prompt = el('prompt').value.trim(); if(!prompt){ alert('Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.'); return; }
Â  const postData = {
Â  Â  title: el('title').value.trim(),
Â  Â  author: el('author').value.trim(),
Â  Â  tag: el('tag').value.trim(),
Â  Â  prompt: prompt,
Â  Â  createdAt: firebase.firestore.FieldValue.serverTimestamp(),Â 
Â  Â  likes: 0
Â  };
Â Â 
Â  try {
Â  Â  await db.collection(PROMPTS_COLLECTION).add(postData);
Â  Â  alert('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨Ù†Ø¬Ø§Ø­!');
Â  Â  el('title').value=''; el('prompt').value=''; el('tag').value=''; el('author').value='';
Â  Â  render();Â 
Â  } catch (e) {
Â  Â  console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ", e);
Â  Â  alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±.');
Â  }
});

el('clearBtn').addEventListener('click', ()=>{ el('title').value=''; el('prompt').value=''; el('tag').value=''; el('author').value=''; });

// 5. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙØ§Ø¹Ù„
function copyPrompt(id){Â 
Â  Â  db.collection(PROMPTS_COLLECTION).doc(id).get().then(doc => {
Â  Â  Â  Â  if (doc.exists) {
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(doc.data().prompt).then(()=>{ alert('Ù†ÙØ³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!'); });Â 
Â  Â  Â  Â  }
Â  Â  });
}

async function deletePrompt(id){Â 
Â  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙˆÙ…ØªØŸ')) return;Â 
Â  try {
Â  Â  await db.collection(PROMPTS_COLLECTION).doc(id).delete();
Â  Â  render();Â 
Â  } catch(e) {
Â  Â  alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù.');
Â  }
}

async function editPrompt(id){Â 
Â  Â  const currentDoc = await db.collection(PROMPTS_COLLECTION).doc(id).get();
Â  Â  if (!currentDoc.exists) return;
Â  Â  const p = currentDoc.data();
Â  Â Â 
Â  Â  const newText = prompt('Ø­Ø±Ø± Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª:', p.prompt);Â 
Â  Â  if(newText===null) return;Â 
Â  Â Â 
Â  Â  const newTitle = prompt('ØºÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§ØªØ±Ùƒ ÙØ§Ø±ØºÙ‹Ø§ Ù„Ù„Ø¥Ø¨Ù‚Ø§Ø¡):', p.title) || p.title;

Â  Â  try {
Â  Â  Â  Â  await db.collection(PROMPTS_COLLECTION).doc(id).update({
Â  Â  Â  Â  Â  Â  prompt: newText,
Â  Â  Â  Â  Â  Â  title: newTitle
Â  Â  Â  Â  });
Â  Â  Â  Â  render();
Â  Â  } catch(e) {
Â  Â  Â  Â  alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.');
Â  Â  }
}

async function toggleLike(id){Â 
Â  Â  try {
Â  Â  Â  Â  const docRef = db.collection(PROMPTS_COLLECTION).doc(id);
Â  Â  Â  Â  await docRef.update({Â 
Â  Â  Â  Â  Â  Â  likes: firebase.firestore.FieldValue.increment(1)Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  render();
Â  Â  } catch(e) {
Â  Â  Â  Â  alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨.');
Â  Â  }
}

// â­ï¸â­ï¸ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª â­ï¸â­ï¸

async function postComment(promptId) {
    const commentInput = el(`commentText-${promptId}`);
    const commentText = commentInput.value.trim();
    const commentAuthor = prompt('Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…Ùƒ Ù„Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)'); 
    
    if (!commentText) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚.');
        return;
    }
    
    const commentData = {
        text: commentText,
        author: commentAuthor || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    };

    try {
        await db.collection(PROMPTS_COLLECTION).doc(promptId).collection('comments').add(commentData);
        commentInput.value = ''; 
        renderComments(promptId); 
    } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚:", e);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚ÙˆØ§Ø¹Ø¯ Firestore.');
    }
}

async function renderComments(promptId) {
    const commentsContainer = el(`commentsContainer-${promptId}`);
    commentsContainer.innerHTML = ''; 

    try {
        const snapshot = await db.collection(PROMPTS_COLLECTION).doc(promptId).collection('comments').orderBy('createdAt', 'asc').get();
        
        if (snapshot.empty) {
            commentsContainer.innerHTML = '<div class="muted" style="font-style: italic; font-size: 13px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚.</div>';
            return;
        }

        let commentsHtml = '';
        snapshot.forEach(doc => {
            const c = doc.data();
            const displayTime = c.createdAt && c.createdAt.toDate ? c.createdAt.toDate().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }) : '';

            commentsHtml += `
                <div style="padding: 6px 0; border-bottom: 1px dashed rgba(255,255,255,0.02);">
                    <div style="font-size: 14px;">
                        <strong>${escapeHtml(c.author)}</strong>
                        <span class="muted" style="font-size: 11px; margin-right: 5px;">${displayTime}</span>
                    </div>
                    <p style="margin: 3px 0 6px 0; font-size: 14px;">${escapeHtml(c.text)}</p>
                </div>
            `;
        });
        commentsContainer.innerHTML = commentsHtml;

    } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª:", e);
        commentsContainer.innerHTML = '<div class="muted">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª.</div>';
    }
}
// â­ï¸â­ï¸ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª â­ï¸â­ï¸


function refreshFilterOptions(tags){Â 
Â  const select = el('filterTag');Â 
Â  const uniqueTags = Array.from(new Set(tags));
Â  const old = select.value;Â 
Â  select.innerHTML = '<option value="">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ³Ù…</option>' + uniqueTags.map(t=>`<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');Â 
Â  if(uniqueTags.includes(old)) select.value = old;Â 
}

el('filterTag').addEventListener('change', render);
el('searchInput').addEventListener('input', render);

// init
render();
Â  </script>
</body>
</html>
