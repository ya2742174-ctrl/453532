<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙŠÙˆØ³Ù â€” Ù…Ù†ØµØ© Ù†Ø´Ø± ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* 1. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† */
    :root {
      --accent: #0ea5e9; /* Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ Ø¬Ø¯ÙŠØ¯ Ø£ÙƒØ«Ø± Ø­ÙŠÙˆÙŠØ© */
      --accent-dark: #0284c7;
      --bg: #0f172a;
      --card: #17253b; /* Ø¨Ø·Ø§Ù‚Ø© Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
      --glass: rgba(255, 255, 255, 0.08); /* ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø£Ù‚ÙˆÙ‰ */
      --text-main: #e6eef6;
      --text-muted: #9fb3c7;
      --border-color: rgba(255, 255, 255, 0.05);
    }
    
    /* 2. Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
    * {
      box-sizing: border-box;
      font-family: 'IBM Plex Sans Arabic', Cairo, 'Segoe UI', Tahoma, sans-serif;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      /* ØªØ¯Ø±Ø¬ Ø®Ù„ÙÙŠØ© Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© */
      background: linear-gradient(180deg, #0d1629 0%, #17253b 100%);
      color: var(--text-main);
      line-height: 1.6;
    }
    
    /* 3. Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ (Header) */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      /* ØªØ¯Ø±Ø¬ Ø·ÙÙŠÙ Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙŠØ¨Ø±Ø² */
      background: rgba(23, 37, 59, 0.5);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      position: sticky; /* Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø´Ø±ÙŠØ· Ø«Ø§Ø¨ØªÙ‹Ø§ */
      top: 0;
      z-index: 100;
    }
    
    .brand {
      display: flex;
      gap: 16px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§Ø¹Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      align-items: center;
    }
    
    .logo {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      /* ØªØ¯Ø±Ø¬ Ø£ÙƒØ«Ø± Ø¬Ø§Ø°Ø¨ÙŠØ© */
      background: linear-gradient(135deg, var(--accent), #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: white;
      box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
    }
    
    h1 { margin: 0; font-size: 22px; font-weight: 600; }
    p.lead { margin: 0; color: var(--text-muted); font-size: 14px; }
    
    /* 4. Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    main {
      padding: 20px;
      max-width: 1200px; /* Ø²ÙŠØ§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      margin: 25px auto;
    }
    
    .grid {
      display: grid;
      grid-template-columns: 380px 1fr; /* Ø²ÙŠØ§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      gap: 25px;
    }
    
    .card {
      background: var(--card);
      border-radius: 14px; /* Ø²ÙˆØ§ÙŠØ§ Ù…Ø¯ÙˆØ±Ø© Ø£ÙƒØ«Ø± */
      padding: 18px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.4); /* ØªØ¸Ù„ÙŠÙ„ Ø£Ø¹Ù…Ù‚ */
    }
    
    /* 5. Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    label {
      font-size: 14px;
      color: var(--text-muted);
      display: block;
      margin-top: 15px;
      font-weight: 500;
    }
    
    input[type=text], textarea, select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background: var(--glass);
      color: inherit;
      font-size: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    input[type=text]:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);
    }
    
    textarea { min-height: 140px; resize: vertical; }
    
    /* 6. Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    button {
      background: var(--accent);
      border: none;
      color: white; /* Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s, transform 0.1s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    button:hover { background: var(--accent-dark); }
    button:active { transform: scale(0.98); }

    .btn-secondary {
      background: #334155 !important;
      color: var(--text-main) !important;
    }
    .btn-secondary:hover { background: #475569 !important; }
    
    .muted { color: var(--text-muted); font-size: 13px; line-height: 1.4; }
    
    /* 7. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª */
    .posts { display: flex; flex-direction: column; gap: 15px; }
    
    .post {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(0, 0, 0, 0.05));
      padding: 18px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      transition: transform 0.2s;
    }

    .post:hover {
        transform: translateY(-2px);
    }
    
    .post .meta {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .post strong {
        font-size: 17px;
        color: var(--accent);
        font-weight: 600;
    }
    
    .post .content {
      white-space: pre-wrap;
      margin-top: 10px;
      font-family: 'IBM Plex Sans Arabic', monospace; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Ù…Ø®ØªÙ„Ù Ù„Ù„Ù†Øµ Ù„ØªÙ…ÙŠÙŠØ²Ù‡ */
      padding: 10px;
      background: var(--glass);
      border-radius: 8px;
      font-size: 15px;
    }
    
    .actions { display: flex; gap: 10px; margin-top: 15px; }
    
    /* 8. Ø§Ù„ÙˆØ³ÙˆÙ… (Chips) */
    .chip {
      background: rgba(255, 255, 255, 0.05);
      color: var(--accent);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid rgba(14, 165, 233, 0.3);
    }

    /* 9. Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© */
    .search-tools {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

    .search-tools input, .search-tools select {
        flex: 1;
        min-width: 150px;
    }
    
    .empty { color: var(--text-muted); text-align: center; padding: 40px 10px; font-size: 16px; }
    
    /* 10. Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¹Ø§Ø¦Ù… (Notification) */
    #notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #10b981; /* Ù„ÙˆÙ† Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø£Ø®Ø¶Ø± */
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.5s, transform 0.5s;
        transform: translateY(20px);
        font-weight: 500;
    }
    .show-notification {
        opacity: 1 !important;
        transform: translateY(0) !important;
    }

    /* 11. Ø§Ù„ÙÙˆØªØ± */
    footer {
        max-width: 1200px;
        margin: 30px auto 15px;
        text-align: center;
        color: #5b728b;
        font-size: 13px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
    }
    
    /* 12. Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
    @media (max-width: 950px) {
      .grid { grid-template-columns: 1fr; }
      header { flex-wrap: wrap; gap: 12px; }
      .brand p { display: block; }
      main { padding: 10px; }
    }
  </style>
</head>
<body>
  <div id="notification">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨Ù†Ø¬Ø§Ø­!</div>

  <header>
    <div class="brand">
      <div class="logo">ğŸ’¡</div>
      <div>
        <h1>ÙŠÙˆØ³Ù ÙˆØ§ Ù…ÙƒØ§Ø±ÙŠÙˆØ³</h1>
        <p class="lead">Ù…Ù†ØµØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù†Ø´Ø± ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª â€” Ø£Ù†Ø´Ø±ØŒ Ø§Ù†Ø³Ø®ØŒ ÙˆØ¬Ø±Ù‘Ø¨</p>
      </div>
    </div>
    <div class="muted">
        <a href="https://yourprofile.com" style="color:inherit; text-decoration:none;">ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ ÙŠÙˆØ³Ù Ø§Ø­Ù…Ø¯ Ø®Ù„ÙŠÙÙ‡</a>.
    </div>
  </header>

  <main>
    <div class="grid">
      <aside class="card">
        <h3 style="margin-top:0; font-weight: 600;">ğŸ“ Ø§Ù†Ø´Ø± Ø¨Ø±ÙˆÙ…Øª Ø¬Ø¯ÙŠØ¯</h3>
        <div style="height:5px"></div>
        <label for="author">Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø¯Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="author" type="text" placeholder="Ù…Ø«Ø§Ù„: ÙŠÙˆØ³Ù" />

        <label for="title">Ø¹Ù†ÙˆØ§Ù† Ù…Ø®ØªØµØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="title" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† ÙŠØµÙ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨ÙˆØ¶ÙˆØ­" />

        <label for="prompt">Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª **(Ù…Ø·Ù„ÙˆØ¨)**</label>
        <textarea id="prompt" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ù‡Ù†Ø§... Ù…Ø«Ø§Ù„: 'ØªØµØ±Ù‘Ù ÙƒØ®Ø¨ÙŠØ± ØªØ³ÙˆÙŠÙ‚ ÙˆØ£Ø¹Ø·Ù†ÙŠ Ø®Ø·Ø© Ù„Ù€...'" ></textarea>

        <label for="tag">ÙˆØ³Ù…/ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="tag" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ø§Ø¯Ø«Ø©ØŒ ØµÙˆØ±Ø©ØŒ ØªØ³ÙˆÙŠÙ‚ØŒ Ø¨Ø±Ù…Ø¬Ø©" />

        <div style="height:20px"></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button id="publishBtn">
            <span style="font-size:18px;">âœ¨</span> Ù†Ø´Ø±
          </button>
          <button id="clearBtn" class="btn-secondary">
            <span style="font-size:18px;">ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
          </button>
        </div>

        <div style="height:15px"></div>
        <div class="muted">
          <p>ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ø³ØªØ®Ø¯Ù… ÙˆØµÙÙ‹Ø§ Ø¯Ù‚ÙŠÙ‚Ù‹Ø§ ÙˆØ§Ø®ØªØ¨Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙŠ Ø³ØªØ³ØªØ®Ø¯Ù…Ù‡ (Ù…Ø«Ù„ ChatGPT Ø£Ùˆ Gemini) Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.</p>
        </div>
      </aside>

      <section>
        <div class="card">
          <div class="search-tools">
            <input id="searchInput" type="text" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£Ùˆ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„ÙˆØ³ÙˆÙ…" />
            <select id="filterTag"><option value="">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ³Ù…</option></select>
          </div>

          <div id="postsContainer" class="posts"></div>
          <div id="emptyState" class="empty" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª Ø¨Ø¹Ø¯ â€” ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø±!</div>
        </div>

        <div style="height:20px"></div>
        <div class="card" style="padding:15px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;justify-content:space-around;">
          <div class="chip">ğŸ’¾ Ù…Ø­ÙÙˆØ¸ ÙÙŠ: **Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firestore**</div>
          <div class="chip">ğŸ”¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨ØªØ§Øª: <span id="count">0</span></div>
          <div class="chip">ğŸŸ¢ Ø§Ù„Ø­Ø§Ù„Ø©: **Ù…ØªØµÙ„**</div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    Ù…ÙˆÙ‚Ø¹ ÙŠÙˆØ³Ù Ø§Ø­Ù…Ø¯ Ø®Ù„ÙŠÙÙ‡ &copy; 2024. ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
  </footer>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    // /////////////////////////////////////////////////////////////
    // // Ù…Ø­ØªÙˆÙ‰ ÙˆØ³Ù… <script> Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ //
    // /////////////////////////////////////////////////////////////

    // 1. Ù…ÙØ§ØªÙŠØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
      // Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªÙŠ Ù†Ø³Ø®ØªÙ‡Ø§ Ù…Ù† ØµÙˆØ±ØªÙƒ
      apiKey: "AIzaSyP016himjW1TiccHc0SiByPjOW0Vzv_Vs",
      authDomain: "yousefprompts-public-58082.firebaseapp.com",
      projectId: "yousefprompts-public-58082",
      storageBucket: "yousefprompts-public-58082.appspot.com",
      messagingSenderId: "1029355842188",
      appId: "1:1029355842188:web:b72df7144a0027c2e6da39",
      measurementId: "G-JY7D5F10YT"
    };

    // 2. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const PROMPTS_COLLECTION = 'prompts'; // Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
    const ADMIN_SECRET = '1541777914111'; // Ø±Ù…Ø² Ø³Ø±ÙŠ Ø¨Ø³ÙŠØ· Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ù„Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„

    const el = id => document.getElementById(id);

    function escapeHtml(s) { return String(s).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;'); }

    // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¦Ù… Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert
    function showNotification(message) {
      const notification = el('notification');
      notification.innerText = message;
      notification.classList.add('show-notification');
      setTimeout(() => {
        notification.classList.remove('show-notification');
      }, 3000);
    }

    // 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ø±Ø¶ (render) Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore
    const render = async () => {
      const container = el('postsContainer');
      container.innerHTML = '';

      let query = db.collection(PROMPTS_COLLECTION).orderBy('createdAt', 'desc');

      const filter = el('filterTag').value.trim();
      const q = el('searchInput').value.trim().toLowerCase();

      let visible = [];
      try {
        const snapshot = await query.get();
        snapshot.forEach(doc => {
          const p = { id: doc.id, ...doc.data() };

          // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          if (filter && (p.tag || '').toLowerCase() !== filter.toLowerCase()) return;
          if (q && !((p.title || '').toLowerCase().includes(q) || p.prompt.toLowerCase().includes(q) || (p.author || '').toLowerCase().includes(q) || (p.tag || '').toLowerCase().includes(q))) return;

          visible.push(p);
        });
      } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", e);
        return;
      }


      if (visible.length === 0) { el('emptyState').style.display = 'block'; } else { el('emptyState').style.display = 'none'; }
      el('count').innerText = visible.length;

      visible.forEach(p => {
        const div = document.createElement('div'); div.className = 'post';

        // ØªØ­ÙˆÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø®Ø§Ø¯Ù… Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ù…Ø­Ù„ÙŠ Ø¨Ø´ÙƒÙ„ Ø£Ø¨Ø³Ø·
        const displayDate = p.createdAt && p.createdAt.toDate ? p.createdAt.toDate().toLocaleDateString('ar-EG', { day: 'numeric', month: 'short', year: 'numeric' }) : 'Ø§Ù„Ø¢Ù†';

        div.innerHTML = `
          <div class="meta">
            <div>
              <strong>${escapeHtml(p.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</strong>
              <div class="muted">${escapeHtml(p.author || 'Ù…Ø¬Ù‡ÙˆÙ„')} Â· ${displayDate}</div>
            </div>
            <div style="text-align:left;min-width:140px">
              <span class="chip">${escapeHtml(p.tag || 'Ø¹Ø§Ù…')}</span>
            </div>
          </div>
          <div class="content">${escapeHtml(p.prompt)}</div>
          <div class="actions">
            <button onclick='copyPrompt("${p.id}")'>Ù†Ø³Ø® ğŸ“‹</button>
            <button onclick='toggleLike("${p.id}")'>${p.likes || 0} â¤ï¸</button>
            <button class="btn-secondary" onclick='editPrompt("${p.id}")'>ØªØ¹Ø¯ÙŠÙ„ âœï¸</button>
            <button class="btn-secondary" style="background:#dc2626 !important; color:white !important;" onclick='deletePrompt("${p.id}")'>Ø­Ø°Ù âŒ</button>
          </div>
        `;
        container.appendChild(div);
      });

      refreshFilterOptions(visible.map(p => p.tag).filter(Boolean));
    }


    // 4. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø´Ø± (Publish)
    document.getElementById('publishBtn').addEventListener('click', async () => {
      const prompt = el('prompt').value.trim(); if (!prompt) { showNotification('âš ï¸ Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.'); return; }
      const postData = {
        title: el('title').value.trim(),
        author: el('author').value.trim() || 'Ù…Ø¬Ù‡ÙˆÙ„',
        tag: el('tag').value.trim() || 'Ø¹Ø§Ù…',
        prompt: prompt,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        likes: 0
      };

      try {
        await db.collection(PROMPTS_COLLECTION).add(postData);
        showNotification('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨Ù†Ø¬Ø§Ø­!');
        el('title').value = ''; el('prompt').value = ''; el('tag').value = ''; el('author').value = '';
        render();
      } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©: ", e);
        showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±.');
      }
    });

    el('clearBtn').addEventListener('click', () => { el('title').value = ''; el('prompt').value = ''; el('tag').value = ''; el('author').value = ''; });

    // 5. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)
    function copyPrompt(id) {
      db.collection(PROMPTS_COLLECTION).doc(id).get().then(doc => {
        if (doc.exists) {
          navigator.clipboard.writeText(doc.data().prompt).then(() => { showNotification('ğŸ“‹ Ù†ÙØ³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©!'); });
        }
      });
    }

    async function deletePrompt(id) {
      // Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
      const code = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø­Ø°Ù:');
      if (code !== ADMIN_SECRET) {
        alert('Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù.');
        return;
      }
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØŸ')) return;

      try {
        await db.collection(PROMPTS_COLLECTION).doc(id).delete();
        showNotification('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø±ÙˆÙ…Øª.');
        render();
      } catch (e) {
        showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù.');
      }
    }

    async function editPrompt(id) {
      // Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
      const code = prompt(Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ ÙŠÙˆØ³Ù ÙÙ‚Ø· ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„);
      if (code !== ADMIN_SECRET) {
        alert('Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.');
        return;
      }

      const currentDoc = await db.collection(PROMPTS_COLLECTION).doc(id).get();
      if (!currentDoc.exists) return;
      const p = currentDoc.data();

      const newText = prompt('Ø­Ø±Ø± Ù†Øµ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª:', p.prompt);
      if (newText === null || newText.trim() === '') return;

      const newTitle = prompt('ØºÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:', p.title) || p.title;

      try {
        await db.collection(PROMPTS_COLLECTION).doc(id).update({
          prompt: newText,
          title: newTitle
        });
        showNotification('âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø¨Ù†Ø¬Ø§Ø­.');
        render();
      } catch (e) {
        showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.');
      }
    }

    async function toggleLike(id) {
      try {
        const docRef = db.collection(PROMPTS_COLLECTION).doc(id);
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await docRef.update({
          likes: firebase.firestore.FieldValue.increment(1)
        });
        render();
      } catch (e) {
        showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨.');
      }
    }

    function refreshFilterOptions(tags) {
      const select = el('filterTag');
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆØ³ÙˆÙ… Ø¥Ù„Ù‰ Ù‚ÙŠÙ… ÙØ±ÙŠØ¯Ø© ÙˆØºÙŠØ± Ø­Ø³Ø§Ø³Ø© Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù Ù„Ù„ØªØµÙÙŠØ©
      const uniqueTags = Array.from(new Set(tags.map(t => t.toLowerCase()))).filter(Boolean);
      const old = select.value;
      select.innerHTML = '<option value="">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ³Ù…</option>' + uniqueTags.map(t => `<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join('');
      // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø§ ØªØ²Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø©
      if (uniqueTags.includes(old.toLowerCase())) select.value = old;
    }

    el('filterTag').addEventListener('change', render);
    el('searchInput').addEventListener('input', render);

    // init
    render();
  </script>
</body>
</html>

